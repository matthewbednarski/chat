<!DOCTYPE html>
<html>

<!-- http://plnkr.co/edit/duWfeVfVx2M7bFUV5hpN -->

<head>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"></link>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <script  src="https://code.angularjs.org/1.3.16/angular.js"></script> -->
    <!-- <script src="http://code.jquery.com/jquery&#45;2.1.4.min.js" data&#45;semver="2.1.4" data&#45;require="jquery@*"></script> -->
    <!-- <script data&#45;require="bootstrap@*" data&#45;semver="3.3.1" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script> -->
    <!-- <script src="http://cdn.peerjs.com/0.3/peer.js"></script> -->
    <!-- <script  src=""></script> -->
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/lodash/lodash.js"></script>
    <script src="bower_components/moment/moment.js"></script>
    <script src="bower_components/peerjs/peer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pouchdb/3.6.0/pouchdb.js"></script>
    <!--script src="https://gist.githubusercontent.com/matthewbednarski/dc079a7cc74b7a2c90c8/raw/72cda5f9f2474b0e783f0d5c0232450e11553505/persist-service.js"></script>
  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/css/bootstrap3/bootstrap-switch.css"
    rel="stylesheet" />
    <script src="js/persist-service.js"></script>
    <script src="js/stream-service.js"></script>
    <script src="js/peer-service.js"></script>
    <script src="switch-directive.js"></script>
    <link href="switch-directive.css" rel="stylesheet" />
    <script src="script.js"></script>
    <link href="style.css" rel="stylesheet" />
    <link href="bower_components/font-awesome/css/font-awesome.css" rel="stylesheet"
    />
</head>

<body ng-controller="controller as ctl" ng-app="app">
    <div class="container">
        <input ng-model="ctl.peer.peer_id" class="form-control" readonly/>
        <button class="btn btn-danger btn-inverse" ng-click="ctl.bootstrapPeer();">Start</button>
        <button ng-show="ctl.peer.peer_id !== undefined" class="btn btn-danger" ng-click="ctl.closePeer();">End</button>
    </div>
    <div class="container-fluid ">
        <div class="row">
            <div class="panel col-sm-12 col-md-9 col-lg-6">
                <div class="panel panel-info" ng-repeat="item in ctl.peer.connections">
                    <div class="panel panel-heading">
                        <a data-toggle="collapse" href="#chat">Chat {{ item.peer_id }}</a>
                        <a ng-click="ctl.closeConnection(item);"><i class="fa fa-times fa-3 pull-right"></i></a>
                    </div>
                    <div id="chat" class="panel panel-body">
                        <div ng-repeat="msg in item.data.chat.messages">
                            <div ng-show="msg.peer !== ctl.peer.peer_id">
                                <h4><span class="label label-warning">Them:</span></h4><span>{{ msg.data }}</span>
                            </div>
                            <div ng-show="msg.peer === ctl.peer.peer_id" class="pull-right">
                                <h4><span class="label label-info">You:</span></h4><span>{{ msg.data }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-footer">
                        <form>
                            <div class="input-group">
                                <input ng-model="ctl.chat_next" type="text" class="form-control" />
                                <span class="input-group-btn" id="basic-addon1">
              <button ng-click="ctl.send(item);" type="submit" class="btn btn-send"><i class="glyphicon glyphicon-share-alt"></i></button>
            </span>
                            </div>
                            <div class="btn-group">
                                <button ng-click="ctl.call(item);" type="button" class="btn btn-success"><i class="fa fa-phone fa-3"></i> 
                                </button>
                                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu">
                                    <button ng-click="ctl.video(item);" class="btn btn-success"><i class="fa fa-video-camera fa-3"></i>
                                    </button>
                                </div>
                                <!-- <div ng&#45;show="ctl.peer.peers.connection !== undefined &#38;&#38; ctl.peer.peers.connection[item.peer_id] !== undefined &#38;&#38; ctl.peer.peers.connection[item.peer_id].remote_stream !== undefined"> -->
                                <button ng-click="ctl.hangUp(item);" type="button" class="btn btn-danger"><i class="fa fa-phone fa-3 fa-rotate-135"></i> 
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- <div ng&#45;show="ctl.peer.peer_id !== undefined" class="col&#45;xs&#45;12 col&#45;sm&#45;6 col&#45;md&#45;8 col&#45;lg&#45;9 col&#45;sm&#45;push&#45;6 col&#45;md&#45;push&#45;4 col&#45;md&#45;push&#45;3"> -->
            <div class="col-xs-12 col-sm-6 col-md-8 col-lg-9 col-sm-push-6 col-lg-push-3 col-md-push-4">
                <div class="container col-sm-7 col-md-7 col-lg-7">
                    <div class="embed-responsive embed-responsive-4by3">
                        {{ ctl.peer.peers.connection[item.peer_id].remote_stream }}
                        <!-- service.peers.connection[c.peer].remote_stream = URL.createObjectURL(remoteStream); -->
                        <video class="embed-responsive-item" ng-src="{{ ctl.peer.peers.connection[item.peer_id].remote_stream }}"
                        controls autoplay></video>
                    </div>
                </div>
                <div class="container col-sm-5 col-md-5 col-lg-5">
                    <div class="embed-responsive embed-responsive-16by9">
                        {{ ctl.peer.peers.connection[item.peer_id].local_stream }}
                        <video class="embed-responsive-item" ng-src="{{ ctl.peer.peers.connection[item.peer_id].local_stream }}"
                        controls autoplay></video>
                    </div>
                </div>
            </div>
            <!-- <div ng&#45;show="ctl.peer.peer_id !== undefined" class="col&#45;xs&#45;12 col&#45;sm&#45;6 col&#45;md&#45;4 col&#45;lg&#45;3 col&#45;sm&#45;pull&#45;6 col&#45;md&#45;pull&#45;8 col&#45;md&#45;pull&#45;9"> -->
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3  col-sm-pull-6 col-lg-pull-9 col-md-pull-8">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-2">
                                <a data-toggle="collapse" href="#collapseList">
                                    <i class="glyphicon glyphicon-chevron-down"></i>
                                </a>
                            </div>
                            <div class="input-group form-group col-xs-10">
                                <div class="input-append">
                                    <input class="form-control" name="filter" placeholder="There are {{ ctl.peer.peers.list.length }} peers available."
                                    ng-model="ctl.peer_list_filter.peer_id" />
                                </div>
                                <span class="input-group-addon"><i class="fa fa-filter"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body" id="collapseList">
                        <ul>
                            <li class="list-unstyled" ng-repeat="item in ctl.peer.peers.list | filter:ctl.peer_list_filter">
                                <button class="btn bg-success btn-block" ng-click="ctl.connect(item);">
                                    <span class="badge bg-danger pull-left">
								<input type="checkbox" name="my-checkbox" ng-checked="item.data !== undefined"/>
							</span>{{item.peer_id}}</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
