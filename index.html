<!DOCTYPE html>
<html>

<!-- http://plnkr.co/edit/duWfeVfVx2M7bFUV5hpN -->

<head>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet" data-semver="3.3.1" data-require="bootstrap-css@*" />
  <script data-require="angular.js@*" data-semver="1.3.16" src="https://code.angularjs.org/1.3.16/angular.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.4.min.js" data-semver="2.1.4" data-require="jquery@*"></script>
  <script data-require="bootstrap@*" data-semver="3.3.1" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script data-require="lodash.js@*" data-semver="3.8.0" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.8.0/lodash.js"></script>
  <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pouchdb/3.6.0/pouchdb.js"></script>
  <!--script src="https://gist.githubusercontent.com/matthewbednarski/dc079a7cc74b7a2c90c8/raw/72cda5f9f2474b0e783f0d5c0232450e11553505/persist-service.js"></script>
  -->
  <script src="stream-factory.js"></script>
  <script src="persist-service.js"></script>
  <script src="script.js"></script>
  <link href="style.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet" />
</head>

<body ng-controller="controller as ctl" ng-app="app">

  <div class="panel">
    <input ng-model="ctl.peer.peer_id" class="form-control" readonly/>
    <!--placeholder="Insert a chat ID, eg '1234' or 'your_name12'" />-->
    <!--
    <button ng-show="ctl.user !== undefined" 
    </button>
    -->
    <button class="btn btn-danger btn-inverse" ng-click="ctl.bootstrapPeer();">Start</button>
    <button ng-show="ctl.peer.peer_id !== undefined" class="btn btn-danger" ng-click="ctl.closePeer();">End</button>
  </div>
  <div ng-show="ctl.peer.peer_id !== undefined" class="panel col-sm-12 col-md-3 col-lg-3">
    <!-- <div ng-show="ctl.peer.peer_id.indexOf('test_ast_') >= 0 ">-->
    <div class="panel panel-info">
      <div class="panel panel-heading">
        <a data-toggle="collapse" href="#collapseList">There are {{ ctl.peer.peers.list.length }} peers available.</a>
      </div>
      <div class="collapse panel-body" id="collapseList">

        <ul>
          <li class="list-unstyled" ng-repeat="item in ctl.peer.peers.list">
            <button class="btn bg-success btn-block" ng-click="ctl.connect(item);"><span class="badge bg-danger pull-left">42</span>{{item}}</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="panel col-sm-12 col-md-9 col-lg-9">
    <div class="panel panel-info" ng-repeat="item in ctl.peer.connections">
      <div class="panel panel-heading">
        <a data-toggle="collapse" href="#chat">Chat {{ item.peer_id }}</a>
        <a ng-click="ctl.closeConnection(item);"><i class="fa fa-times fa-3 pull-right"></i></a>
      </div>
      <div id="chat" class="panel panel-body collapse">
        <div ng-repeat="msg in item.data.chat.messages">
          <div ng-show="msg.peer !== ctl.peer.peer_id">
            <h4><span class="label label-warning">Them:</span></h4><span>{{ msg.data }}</span>
          </div>
          <div ng-show="msg.peer === ctl.peer.peer_id" class="pull-right">
            <h4><span class="label label-info">You:</span></h4><span>{{ msg.data }}</span>
          </div>
        </div>
      </div>
      <div class="panel panel-footer">
        <form>
          <div class="input-group">
            <input ng-model="ctl.chat_next" type="text" class="form-control" />
            <span class="input-group-btn" id="basic-addon1">
              <button ng-click="ctl.send(item);" type="submit" class="btn btn-send"><i class="glyphicon glyphicon-share-alt"></i></button>
            </span>
          </div>
          <div class="btn-group">
            <button ng-click="ctl.call(item);" type="button" class="btn btn-success"><i class="fa fa-phone fa-3"></i></button>
            <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <div class="dropdown-menu">
              <button ng-click="ctl.video(item);" class="btn btn-success"><i class="fa fa-video-camera fa-3"></i></button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div ng-show="ctl.video.them" class="panel panel-success">
    <div class="panel panel-heading">
      <a data-toggle="collapse" href="#them">Them</a>
    </div>
    <div id="them" class="panel panel-body collapse" area-expanded="false" aria-controls="them">
      <div class="embed-responsive embed-responsive-16by9">
        <video class="embed-responsive-item" src="{{ ctl.peer.peers.call.in.url }}" controls autoplay></video>
        {{ ctl.peer.peers.call.out.url }}
      </div>
    </div>
  </div>
  <div ng-show="ctl.video.you" class="panel panel-danger">
    <div class="panel panel-heading">
      <a data-toggle="collapse" href="#you">You</a>
    </div>
    <div id="you" class="panel panel-body collapse" area-expanded="false" area-controls="you">
      <div class="embed-responsive embed-responsive-16by9">
        <video class="embed-responsive-item" src="{{ ctl.peer.peers.call.out.url }}" controls autoplay></video>
      </div>
    </div>
  </div>


</body>

</html>